# 测试任务跟踪系统优化说明

## 优化内容

### 1. 时间处理优化 - 本地时间显示

**问题**: 系统显示的是UTC时间，需要优化为本地时间

**解决方案**:
- 前端使用 `dayjs().local()` 确保时间显示为本地时间
- 修改了以下文件的时间格式化函数：
  - `frontend/src/views/Dashboard.vue`
  - `frontend/src/views/Tasks.vue`
  - `frontend/src/views/Alerts.vue`
  - `frontend/src/views/Profile.vue`

**技术实现**:
```javascript
// 格式化时间 - 使用本地时间
const formatTime = (time) => {
  return dayjs(time).local().format('MM-DD HH:mm')
}

// 格式化日期时间 - 使用本地时间
const formatDateTime = (date) => {
  if (!date) return '-'
  return dayjs(date).local().format('YYYY-MM-DD HH:mm')
}
```

### 2. 菜单栏颜色对比优化

**问题**: 菜单栏选中后文字不清晰

**解决方案**:
- 优化了菜单选中状态的样式
- 增强了文字与背景的对比度

**技术实现**:
```css
.el-menu-item.is-active {
  background-color: #1890ff !important;
  color: #ffffff !important;
}

.el-menu-item.is-active:hover {
  background-color: #40a9ff !important;
  color: #ffffff !important;
}

.el-menu-item:hover {
  background-color: #263445 !important;
  color: #ffffff !important;
}
```

### 3. 任务进度模块

**功能**: 添加任务进度跟踪功能，支持进度历史记录

**新增功能**:
- 任务进度更新记录
- 进度描述、风险等级、阻碍因素、下一步计划
- 进度历史时间线显示
- 支持添加、查看、删除进度记录

**技术实现**:

#### 后端新增文件:
- `src/main/java/com/testtracking/controller/TaskProgressController.java` - 进度控制器
- `src/main/java/com/testtracking/service/TaskProgressService.java` - 进度服务
- 更新了 `TaskProgressRepository.java` - 添加查询方法

#### 前端新增功能:
- 任务编辑时添加进度模块
- 任务详情页面增加进度历史标签页
- 进度添加对话框
- 进度时间线显示

#### 数据库表结构:
```sql
-- 任务进度表已存在，包含以下字段:
-- id, task_id, updated_by_user, progress_percentage, progress_notes
-- update_time, task_status, risk_level, risk_description
-- blockers, next_steps, created_time, updated_time
```

### 4. 数据库备份功能

**功能**: 自动数据库备份，防止数据丢失

**新增功能**:
- 定时自动备份（每周一凌晨2点）
- 手动触发备份
- 备份文件管理
- 自动清理旧备份文件

**技术实现**:

#### 后端新增文件:
- `src/main/java/com/testtracking/service/DatabaseBackupService.java` - 备份服务
- `src/main/java/com/testtracking/controller/DatabaseBackupController.java` - 备份控制器

#### 配置更新:
```yaml
# 数据库备份配置
backup:
  path: /backup  # 备份文件存储路径
  retention:
    days: 30  # 备份文件保留天数
```

#### API接口:
- `POST /api/backup/manual` - 手动触发备份
- `GET /api/backup/files` - 获取备份文件列表
- `POST /api/backup/cleanup` - 清理旧备份文件

### 5. 开始时间查询条件

**功能**: 在任务列表中增加开始时间范围查询

**新增功能**:
- 开始时间范围选择器
- 支持按开始时间范围筛选任务

**技术实现**:

#### 后端更新:
- 更新了 `TestTaskRepository.java` - 添加开始时间查询条件
- 更新了 `TestTaskService.java` - 添加开始时间参数
- 更新了 `TestTaskController.java` - 添加开始时间查询参数

#### 前端更新:
- 在任务列表搜索区域添加日期范围选择器
- 支持按开始时间范围筛选任务

## 部署说明

### 1. 数据库备份配置

确保服务器上安装了 `mysqldump` 工具：
```bash
# Ubuntu/Debian
sudo apt-get install mysql-client

# CentOS/RHEL
sudo yum install mysql
```

### 2. 备份目录权限

确保备份目录有正确的权限：
```bash
sudo mkdir -p /backup
sudo chown -R appuser:appuser /backup
sudo chmod 755 /backup
```

### 3. 定时任务

系统已配置定时备份任务，每周一凌晨2点自动执行。

### 4. 前端部署

重新构建前端项目：
```bash
cd frontend
npm run build
```

## 使用说明

### 1. 任务进度管理

1. 在任务列表中点击"详情"按钮
2. 切换到"进度历史"标签页
3. 点击"添加进度更新"按钮
4. 填写进度信息并保存

### 2. 数据库备份

1. 管理员可以通过API手动触发备份
2. 备份文件存储在配置的路径中
3. 系统会自动清理30天前的备份文件

### 3. 时间查询

1. 在任务列表页面使用日期范围选择器
2. 选择开始时间范围进行筛选
3. 系统会显示符合时间范围的任务

## 注意事项

1. 数据库备份功能需要确保服务器有足够的磁盘空间
2. 备份文件会占用一定存储空间，建议定期清理
3. 时间显示优化确保了用户看到的是本地时间
4. 菜单栏优化提升了用户体验
5. 任务进度功能增强了项目管理能力
